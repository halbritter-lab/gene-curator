"use strict";(self["webpackChunkgene_curator"]=self["webpackChunkgene_curator"]||[]).push([[261],{4157:function(e,t,a){a.d(t,{FH:function(){return u},TN:function(){return c},VG:function(){return o},lO:function(){return s},pK:function(){return r}});a(560);var n=a(4287),i=a(6056);const o=async()=>{const e=await(0,n.PL)((0,n.hJ)(i.db,"curations"));let t={};return e.forEach((e=>{if(!e.exists())throw new Error("Curation document not found");t[e.id]={id:e.id,...e.data()}})),t},l=(e,t)=>{const a=[];for(const[n,i]of Object.entries(t)){const t=e[n];i.required&&!t&&a.push(`The field "${i.label}" is required.`),"number"===i.format&&(void 0!==i.min&&t<i.min&&a.push(`The value for "${i.label}" should not be less than ${i.min}.`),void 0!==i.max&&t>i.max&&a.push(`The value for "${i.label}" should not exceed ${i.max}.`))}return a},r=async(e,t,a)=>{const o=l(e,a);if(o.length>0)throw new Error(`Validation failed: ${o.join(" ")}`);const r=await p({approvedSymbol:e.approved_symbol,disease:e.disease,inheritance:e.inheritance});if(r)throw new Error("A curation with the same symbol, disease, and inheritance already exists.");const s=(0,n.JU)((0,n.hJ)(i.db,"curations"));return await(0,n.pl)(s,{...e,users:[t],createdAt:n.EK.fromDate(new Date),updatedAt:n.EK.fromDate(new Date),id:s.id}),s.id},s=async(e,t,a,o)=>{const r=l(t,o);if(r.length>0)throw new Error(`Validation failed: ${r.join(" ")}`);const s=(0,n.JU)(i.db,"curations",e),u=await(0,n.QT)(s);if(!u.exists())throw new Error("Curation document not found");const c=u.data(),p=d(c.users||[],a);await(0,n.r7)(s,{...t,users:p,updatedAt:n.EK.fromDate(new Date)})},u=async e=>{const t=(0,n.JU)(i.db,"curations",e);await(0,n.oe)(t)},c=async e=>{const t=(0,n.hJ)(i.db,"curations"),a=(0,n.IO)(t,(0,n.ar)("approved_symbol","==",e)),o=(0,n.IO)(t,(0,n.ar)("hgnc_id","==",e));let l=[];const r=e=>{e.exists()&&l.push({id:e.id,...e.data()})},s=await(0,n.PL)(a);if(s.forEach(r),0===l.length){const e=await(0,n.PL)(o);e.forEach(r)}return l},d=(e,t)=>{const a=e.filter((e=>e!==t));return a.push(t),a},p=async({approvedSymbol:e,disease:t,inheritance:a})=>{const o=(0,n.hJ)(i.db,"curations"),l=(0,n.IO)(o,(0,n.ar)("approved_symbol","==",e),(0,n.ar)("disease","==",t),(0,n.ar)("inheritance","==",a)),r=await(0,n.PL)(l);return!r.empty}},9441:function(e,t,a){a.d(t,{QY:function(){return c},ds:function(){return s},el:function(){return r},wp:function(){return l},x6:function(){return u}});a(560);var n=a(4287),i=a(6056);const o=(e,t)=>{const a=[];for(const[n,i]of Object.entries(t)){const t=e[n];!i.required||void 0!==t&&""!==t||a.push(`The field "${i.label}" is required.`),"number"===i.format&&(void 0!==i.min&&t<i.min&&a.push(`The value for "${i.label}" should not be less than ${i.min}.`),void 0!==i.max&&t>i.max&&a.push(`The value for "${i.label}" should not exceed ${i.max}.`))}return a},l=async()=>{const e=await(0,n.PL)((0,n.hJ)(i.db,"precurations"));let t={};return e.forEach((e=>{if(!e.exists())throw new Error("Precuration document not found");t[e.id]={id:e.id,...e.data()}})),t},r=async(e,t,a)=>{const l=o(e,a);if(l.length>0)throw new Error(`Validation failed: ${l.join(" ")}`);const r=(0,n.JU)((0,n.hJ)(i.db,"precurations"));return await(0,n.pl)(r,{...e,users:[t],createdAt:n.EK.fromDate(new Date),updatedAt:n.EK.fromDate(new Date),id:r.id}),r.id},s=async e=>{const t=(0,n.hJ)(i.db,"precurations"),a=(0,n.IO)(t,(0,n.ar)("approved_symbol","==",e)),o=(0,n.IO)(t,(0,n.ar)("hgnc_id","==",e)),l=await(0,n.PL)(a),r=await(0,n.PL)(o);let s=null;return l.forEach((e=>{e.exists()&&(s={id:e.id,...e.data()})})),s||r.forEach((e=>{e.exists()&&(s={id:e.id,...e.data()})})),s},u=async(e,t,a,l)=>{const r=o(t,l);if(r.length>0)throw new Error(`Validation failed: ${r.join(" ")}`);const s=(0,n.JU)(i.db,"precurations",e),u=await(0,n.QT)(s);if(!u.exists())throw new Error("Precuration document not found");const c=u.data(),p=d(c.users||[],a);await(0,n.r7)(s,{...t,users:p,updatedAt:n.EK.fromDate(new Date)})},c=async e=>{const t=(0,n.JU)(i.db,"precurations",e);await(0,n.oe)(t)},d=(e,t)=>{const a=e.filter((e=>e!==t));return a.push(t),a}},772:function(e,t,a){a.d(t,{Z:function(){return S}});var n=a(3396),i=a(7139);const o={class:"d-flex justify-space-between align-center"};function l(e,t,a,l,r,s){const u=(0,n.up)("GeneLinkChips"),c=(0,n.up)("v-card-title"),d=(0,n.up)("v-icon"),p=(0,n.up)("v-btn"),m=(0,n.up)("v-tab"),h=(0,n.up)("v-tabs"),w=(0,n.up)("GeneDetailCard"),g=(0,n.up)("PrecurationForm"),f=(0,n.up)("v-window-item"),b=(0,n.up)("CurationForm"),v=(0,n.up)("v-window"),y=(0,n.up)("v-card-text"),k=(0,n.up)("v-spacer"),D=(0,n.up)("v-card-actions"),_=(0,n.up)("v-card"),C=(0,n.up)("v-dialog"),V=(0,n.up)("MessageSnackbar");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(C,{modelValue:l.isOpen,"onUpdate:modelValue":t[2]||(t[2]=e=>l.isOpen=e),persistent:"","max-width":"1200px"},{default:(0,n.w5)((()=>[(0,n.Wm)(_,null,{default:(0,n.w5)((()=>[(0,n._)("div",o,[(0,n.Wm)(c,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(l.title)+" - "+(0,i.zw)(l.editedItem.approved_symbol)+" - HGNC:"+(0,i.zw)(l.editedItem.hgnc_id)+" ",1),(0,n.Wm)(u,{"hgnc-id":l.editedItem.hgnc_id,"gene-symbol":l.editedItem.approved_symbol,"links-to-show":["clingen","gencc","search_omim"]},null,8,["hgnc-id","gene-symbol"])])),_:1}),(0,n.Wm)(p,{icon:"",onClick:l.close},{default:(0,n.w5)((()=>[(0,n.Wm)(d,null,{default:(0,n.w5)((()=>[(0,n.Uk)("mdi-close")])),_:1})])),_:1},8,["onClick"])]),(0,n.Wm)(y,null,{default:(0,n.w5)((()=>[(0,n.Wm)(h,{modelValue:l.tab,"onUpdate:modelValue":t[0]||(t[0]=e=>l.tab=e),grow:""},{default:(0,n.w5)((()=>[l.showPreCurationTab?((0,n.wg)(),(0,n.j4)(m,{key:0},{default:(0,n.w5)((()=>[(0,n.Uk)("Pre-Curation")])),_:1})):(0,n.kq)("",!0),l.showCurationTab?((0,n.wg)(),(0,n.j4)(m,{key:1},{default:(0,n.w5)((()=>[(0,n.Uk)("Curation")])),_:1})):(0,n.kq)("",!0)])),_:1},8,["modelValue"]),(0,n.Wm)(v,{modelValue:l.tab,"onUpdate:modelValue":t[1]||(t[1]=e=>l.tab=e),style:{"min-height":"300px"}},{default:(0,n.w5)((()=>[(0,n.Wm)(f,null,{default:(0,n.w5)((()=>[l.showGeneDetailCard?((0,n.wg)(),(0,n.j4)(w,{key:0,id:l.editedItem.hgnc_id,visibilityScope:"curationView",showTitle:!1,onGeneDataLoaded:l.handleGeneDataLoaded},null,8,["id","onGeneDataLoaded"])):(0,n.kq)("",!0),l.geneData?((0,n.wg)(),(0,n.j4)(g,{key:1,"gene-object":l.geneData,onPrecurationAccepted:l.handlePrecurationAccepted},null,8,["gene-object","onPrecurationAccepted"])):(0,n.kq)("",!0)])),_:1}),l.showCurationTab?((0,n.wg)(),(0,n.j4)(f,{key:0},{default:(0,n.w5)((()=>[(0,n.Wm)(b,{approvedSymbol:l.editedItem.approved_symbol,hgncId:l.editedItem.hgnc_id,precurationDetails:l.precurationDetails},null,8,["approvedSymbol","hgncId","precurationDetails"])])),_:1})):(0,n.kq)("",!0)])),_:1},8,["modelValue"])])),_:1}),(0,n.Wm)(D,null,{default:(0,n.w5)((()=>[(0,n.Wm)(k),(0,n.Wm)(p,{color:"blue darken-1",text:"",onClick:l.close},{default:(0,n.w5)((()=>[(0,n.Uk)("Cancel")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,n.Wm)(V,{modelValue:l.snackbarVisible,"onUpdate:modelValue":t[3]||(t[3]=e=>l.snackbarVisible=e),title:l.snackbarTitle,message:l.snackbarMessage,color:l.snackbarColor},null,8,["modelValue","title","message","color"])],64)}var r=a(4870),s=a(7157);function u(e,t,a,o,l,r){const s=(0,n.up)("HelpIcon"),u=(0,n.up)("v-card-title"),c=(0,n.up)("v-col"),d=(0,n.up)("v-switch"),p=(0,n.up)("v-tooltip"),m=(0,n.up)("v-text-field"),h=(0,n.up)("v-select"),w=(0,n.up)("v-row"),g=(0,n.up)("v-btn"),f=(0,n.up)("v-container"),b=(0,n.up)("v-card-text"),v=(0,n.up)("v-card"),y=(0,n.up)("MessageSnackbar");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(v,{class:"elevation-2"},{default:(0,n.w5)((()=>[(0,n.Wm)(u,null,{default:(0,n.w5)((()=>[(0,n.Uk)(" Precuration "),(0,n.Wm)(s,{helpContent:l.helpContent},null,8,["helpContent"])])),_:1}),(0,n.Wm)(b,null,{default:(0,n.w5)((()=>[(0,n.Wm)(f,null,{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(r.groupedFields,((e,t)=>((0,n.wg)(),(0,n.iD)(n.HY,{key:t},[r.groupHasVisibleFields(e)?((0,n.wg)(),(0,n.j4)(w,{key:0},{default:(0,n.w5)((()=>[(0,n.Wm)(c,{cols:"12"},{default:(0,n.w5)((()=>[(0,n._)("h2",null,(0,i.zw)(t),1)])),_:2},1024),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e,((t,a)=>((0,n.wg)(),(0,n.j4)(c,{key:a,cols:12/e.length},{default:(0,n.w5)((()=>["boolean"===t.format&&t.visibility.curationView?((0,n.wg)(),(0,n.iD)(n.HY,{key:0},[(0,n.Wm)(d,{modelValue:l.precurationData[t.key],"onUpdate:modelValue":e=>l.precurationData[t.key]=e,label:t.label,"false-value":!1,"true-value":!0,color:"switch"===t.style.curationView?t.style.color:"",class:(0,i.C_)({"inactive-switch":!l.precurationData[t.key]&&"switch"===t.style.curationView})},null,8,["modelValue","onUpdate:modelValue","label","color","class"]),(0,n.Wm)(p,{activator:"parent",location:"top"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(t.description),1)])),_:2},1024)],64)):t.style&&"text-field"===t.style.curationView&&t.visibility.curationView?((0,n.wg)(),(0,n.iD)(n.HY,{key:1},[(0,n.Wm)(m,{modelValue:l.precurationData[t.key],"onUpdate:modelValue":e=>l.precurationData[t.key]=e,label:t.label,class:(0,i.C_)("text-field"===t.style.curationView?"custom-text-field":"")},null,8,["modelValue","onUpdate:modelValue","label","class"]),(0,n.Wm)(p,{activator:"parent",location:"top"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(t.description),1)])),_:2},1024)],64)):t.style&&"select"===t.style.curationView&&t.visibility.curationView?((0,n.wg)(),(0,n.iD)(n.HY,{key:2},[(0,n.Wm)(h,{modelValue:l.precurationData[t.key],"onUpdate:modelValue":e=>l.precurationData[t.key]=e,items:t.options,label:t.label,class:(0,i.C_)({"prefilled-field":l.decisionPrefilled&&"decision"===t.key,"manually-changed-field":l.decisionManuallyChanged&&"decision"===t.key})},null,8,["modelValue","onUpdate:modelValue","items","label","class"]),(0,n.Wm)(p,{activator:"parent",location:"top"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(t.description),1)])),_:2},1024)],64)):(0,n.kq)("",!0)])),_:2},1032,["cols"])))),128))])),_:2},1024)):(0,n.kq)("",!0)],64)))),128)),(0,n.Wm)(w,null,{default:(0,n.w5)((()=>[(0,n.Wm)(c,{cols:"12",class:"text-right"},{default:(0,n.w5)((()=>[(0,n.Wm)(g,{color:"primary",onClick:r.submitPrecuration},{default:(0,n.w5)((()=>[(0,n.Uk)("Accept")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),(0,n.Wm)(y,{modelValue:l.snackbarVisible,"onUpdate:modelValue":t[0]||(t[0]=e=>l.snackbarVisible=e),title:l.snackbarTitle,message:l.snackbarMessage,color:l.snackbarColor},null,8,["modelValue","title","message","color"])],64)}a(560);var c=a(889),d=a(9441),p=a(3191),m=a(1924),h={name:"PrecurationForm",props:{geneObject:Object},emits:["precuration-accepted"],components:{HelpIcon:m.Z},data(){return{precurationData:this.initializePrecurationData(),existingPrecurationId:null,decisionPrefilled:!1,decisionManuallyChanged:!1,snackbarVisible:!1,snackbarMessage:"",snackbarTitle:"",snackbarColor:"success",helpContent:c.$o.stages.precuration.helpConfig}},computed:{groupedFields(){const e=this.precurationFields,t={};return e.forEach((e=>{t[e.group.name]||(t[e.group.name]=[]),t[e.group.name].push(e)})),Object.values(t).forEach((e=>{e.sort(((e,t)=>e.group.order-t.group.order))})),t},precurationFields(){let e=Object.entries(c.m_).map((([e,t])=>({...t,key:e})));return e}},watch:{precurationData:{deep:!0,handler(){this.applyDecisionRules()}},"precurationData.decision":"onDecisionChange"},methods:{showSnackbar(e,t,a="success"){this.snackbarTitle=e,this.snackbarMessage=t,this.snackbarColor=a,this.snackbarVisible=!0},applyDecisionRules(){const e=c.$o.stages.precuration.decisionRules[0];let t=e.conditions.reduce(((e,t)=>this.precurationData[t]?e+1:e),0);t>=e.threshold?this.precurationData.decision!==e.decision&&this.precurationData.decision||(this.precurationData.decision=e.decision,this.decisionPrefilled=!0,this.decisionManuallyChanged=!1):this.decisionPrefilled&&(this.decisionPrefilled=!1)},onDecisionChange(e){const t=c.$o.stages.precuration.decisionRules[0];let a=t.conditions.reduce(((e,t)=>this.precurationData[t]?e+1:e),0);const n=a>=t.threshold?t.decision:"";this.decisionManuallyChanged=e!==n,this.decisionManuallyChanged?this.updateCommentField("Decision manually overridden."):this.removeCommentOverride()},updateCommentField(e){this.precurationData.comment.includes(e)||(this.precurationData.comment+=(this.precurationData.comment?" ":"")+e)},removeCommentOverride(){const e="Decision manually overridden.";this.precurationData.comment.includes(e)&&(this.precurationData.comment=this.precurationData.comment.replace(e,"").trim())},groupHasVisibleFields(e){return e.some((e=>e.visibility.curationView))},initializePrecurationData(){const e={};if(Object.keys(c.m_).forEach((t=>{this.geneObject&&t in this.geneObject?e[t]=this.geneObject[t]:e[t]="boolean"!==c.m_[t].format&&""})),this.geneObject&&this.geneObject.docId){const t=this.geneObject.docId,a={};Object.keys(c.Wk).forEach((e=>{e in this.geneObject&&(a[e]=this.geneObject[e])})),e["geneDetails"]={[t]:a}}return e},validatePrecurationData(e){const t=[];for(const[a,n]of Object.entries(c.m_))!n.required||void 0!==e[a]&&""!==e[a]||t.push(`The field "${n.label}" is required.`);return t},async submitPrecuration(){const e=JSON.parse(localStorage.getItem("user")).uid;try{const t=this.validatePrecurationData(this.precurationData,c.m_);if(t.length>0)throw new Error(`Validation failed: ${t.join(" ")}`);const a=(new Date).toISOString();let n;this.existingPrecurationId?(this.precurationData.updatedAt=a,await(0,d.x6)(this.existingPrecurationId,this.precurationData,e,c.m_),n=this.existingPrecurationId,this.showSnackbar("Success","Precuration updated"+this.existingPrecurationId,"success")):(this.precurationData.createdAt=a,this.precurationData.workflowConfigVersionUsed=c.se,this.precurationData.workflowConfigNameUsed=c.l9,n=await(0,d.el)(this.precurationData,e,c.m_),this.showSnackbar("Success","New precuration created with ID:"+n,"success")),this.geneObject&&this.geneObject.docId&&await(0,p.zJ)(this.geneObject.docId,{hasPrecuration:n,precuratedBy:e}),this.$emit("precuration-accepted",{docId:n,...this.precurationData})}catch(t){this.showSnackbar("Error",t.message||"There was an error submitting the precuration","error")}},displaySwitchValue(e){return e?"Yes":"No"}},async created(){if(this.geneObject&&(this.geneObject.approved_symbol||this.geneObject.hgnc_id))try{const e=this.geneObject.approved_symbol||this.geneObject.hgnc_id,t=await(0,d.ds)(e);t&&(this.existingPrecurationId=t.id,Object.assign(this.precurationData,t))}catch(e){this.showSnackbar("Error","Error fetching precuration: "+e.message,"error")}}},w=a(89);const g=(0,w.Z)(h,[["render",u],["__scopeId","data-v-697bd6de"]]);var f=g;function b(e,t,a,o,l,r){const s=(0,n.up)("HelpIcon"),u=(0,n.up)("v-icon"),c=(0,n.up)("v-btn"),d=(0,n.up)("v-card-title"),p=(0,n.up)("v-col"),m=(0,n.up)("v-text-field"),h=(0,n.up)("v-tooltip"),w=(0,n.up)("v-checkbox"),g=(0,n.up)("v-select"),f=(0,n.up)("v-row"),b=(0,n.up)("v-expansion-panel-text"),v=(0,n.up)("v-expansion-panel"),y=(0,n.up)("v-expansion-panels"),k=(0,n.up)("v-spacer"),D=(0,n.up)("v-card-actions"),_=(0,n.up)("v-card"),C=(0,n.up)("MessageSnackbar");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(_,{class:"elevation-2"},{default:(0,n.w5)((()=>[(0,n.Wm)(d,null,{default:(0,n.w5)((()=>[(0,n.Uk)(" Curation ("+(0,i.zw)(r.curationEntityCount)+" Entities) ",1),(0,n.Wm)(s,{helpContent:l.helpContent},null,8,["helpContent"]),(0,n.Wm)(c,{icon:"",class:"add-curation-btn",onClick:r.addCurationEntity},{default:(0,n.w5)((()=>[(0,n.Wm)(u,null,{default:(0,n.w5)((()=>[(0,n.Uk)("mdi-plus")])),_:1})])),_:1},8,["onClick"])])),_:1}),(0,n.Wm)(y,{multiple:"",open:"",modelValue:l.openedPanels,"onUpdate:modelValue":t[0]||(t[0]=e=>l.openedPanels=e)},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(l.curationDataArray,((e,t)=>((0,n.wg)(),(0,n.j4)(v,{key:`curation-${t}`,title:`Curation Entity ${t+1}`},{default:(0,n.w5)((()=>[(0,n.Wm)(b,null,{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(r.groupedFields,((a,o)=>((0,n.wg)(),(0,n.iD)(n.HY,{key:o},[r.groupHasVisibleFields(a)?((0,n.wg)(),(0,n.j4)(f,{key:0},{default:(0,n.w5)((()=>[(0,n.Wm)(p,{cols:"12"},{default:(0,n.w5)((()=>[(0,n._)("h2",null,(0,i.zw)(o),1)])),_:2},1024),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(a,((o,l)=>((0,n.wg)(),(0,n.j4)(p,{key:`field-${t}-${l}`,cols:12/a.length},{default:(0,n.w5)((()=>["text"===o.format&&o.style&&"text-field"===o.style.curationView?((0,n.wg)(),(0,n.iD)(n.HY,{key:0},[(0,n.Wm)(m,{modelValue:e[o.key],"onUpdate:modelValue":t=>e[o.key]=t,rules:r.getFieldRules(o),label:o.label,outlined:"",dense:""},null,8,["modelValue","onUpdate:modelValue","rules","label"]),(0,n.Wm)(h,{activator:"parent",location:"top"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(o.description),1)])),_:2},1024)],64)):"boolean"===o.format?((0,n.wg)(),(0,n.iD)(n.HY,{key:1},[(0,n.Wm)(w,{modelValue:e[o.key],"onUpdate:modelValue":t=>e[o.key]=t,rules:r.getFieldRules(o),label:o.label},null,8,["modelValue","onUpdate:modelValue","rules","label"]),(0,n.Wm)(h,{activator:"parent",location:"top"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(o.description),1)])),_:2},1024)],64)):"number"===o.format?((0,n.wg)(),(0,n.iD)(n.HY,{key:2},[(0,n.Wm)(m,{modelValue:e[o.key],"onUpdate:modelValue":t=>e[o.key]=t,rules:r.getFieldRules(o),label:o.label,min:o.min,max:o.max,step:o.step||1,type:"number",outlined:"",dense:""},null,8,["modelValue","onUpdate:modelValue","rules","label","min","max","step"]),(0,n.Wm)(h,{activator:"parent",location:"top"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(o.description),1)])),_:2},1024)],64)):"array"===o.format&&o.style&&"select"===o.style.curationView?((0,n.wg)(),(0,n.iD)(n.HY,{key:3},[(0,n.Wm)(g,{modelValue:e[o.key],"onUpdate:modelValue":t=>e[o.key]=t,rules:r.getFieldRules(o),items:o.options,label:o.label,multiple:"",outlined:"",dense:""},null,8,["modelValue","onUpdate:modelValue","rules","items","label"]),(0,n.Wm)(h,{activator:"parent",location:"top"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(o.description),1)])),_:2},1024)],64)):"text"===o.format&&o.style&&"select"===o.style.curationView?((0,n.wg)(),(0,n.iD)(n.HY,{key:4},[(0,n.Wm)(g,{modelValue:e[o.key],"onUpdate:modelValue":t=>e[o.key]=t,items:o.options,"item-value":"value","item-text":"title",label:o.label,outlined:"",dense:""},null,8,["modelValue","onUpdate:modelValue","items","label"]),(0,n.Wm)(h,{activator:"parent",location:"top"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(o.description),1)])),_:2},1024)],64)):(0,n.kq)("",!0)])),_:2},1032,["cols"])))),128))])),_:2},1024)):(0,n.kq)("",!0)],64)))),128))])),_:2},1024)])),_:2},1032,["title"])))),128))])),_:1},8,["modelValue"]),(0,n.Wm)(D,null,{default:(0,n.w5)((()=>[(0,n.Wm)(k),(0,n.Wm)(c,{color:"primary",onClick:r.saveCuration},{default:(0,n.w5)((()=>[(0,n.Uk)("Save All")])),_:1},8,["onClick"])])),_:1})])),_:1}),(0,n.Wm)(C,{modelValue:l.snackbarVisible,"onUpdate:modelValue":t[1]||(t[1]=e=>l.snackbarVisible=e),title:l.snackbarTitle,message:l.snackbarMessage,color:l.snackbarColor},null,8,["modelValue","title","message","color"])],64)}var v=a(4157);const y=e=>!!e||"This field is required";const k=e=>!isNaN(parseFloat(e))&&isFinite(e)||"Must be a number",D=e=>t=>parseFloat(t)>=e||`Minimum value is ${e}`,_=e=>t=>parseFloat(t)<=e||`Maximum value is ${e}`;var C={name:"CurationForm",props:{approvedSymbol:String,hgncId:String,precurationDetails:Object},components:{HelpIcon:m.Z},data(){return{curationDataArray:[this.initializeCurationData()],existingCurationId:null,snackbarVisible:!1,snackbarMessage:"",snackbarTitle:"",snackbarColor:"success",helpContent:c.$o.stages.curation.helpConfig,openedPanels:[0]}},async created(){if(this.hgncId||this.approvedSymbol)try{const e=await(0,v.TN)(this.hgncId||this.approvedSymbol);e.length>0?this.curationDataArray=e.map((e=>Object.assign(this.initializeCurationData(),e))):this.curationDataArray=[this.initializeCurationData()]}catch(e){this.showSnackbar("Error",`Error fetching curations: ${e.message}`,"error")}else this.curationDataArray=[this.initializeCurationData()]},computed:{groupedFields(){const e=Object.entries(c.U8).map((([e,t])=>({...t,key:e}))),t={};return e.forEach((e=>{t[e.group.name]||(t[e.group.name]=[]),t[e.group.name].push(e)})),Object.values(t).forEach((e=>{e.sort(((e,t)=>e.group.order-t.group.order))})),t},curationEntityCount(){return this.curationDataArray.length}},methods:{getFieldRules(e){const t=[];return e.required&&t.push(y),"number"===e.format&&(t.push(k),void 0!==e.min&&t.push(D(e.min)),void 0!==e.max&&t.push(_(e.max))),t},showSnackbar(e,t,a="success"){this.snackbarTitle=e,this.snackbarMessage=t,this.snackbarColor=a,this.snackbarVisible=!0},groupHasVisibleFields(e){return e.some((e=>e.visibility.curationView))},addCurationEntity(){this.curationDataArray.push(this.initializeCurationData())},initializeCurationData(){const e={};if(Object.keys(c.U8).forEach((t=>{const a=c.U8[t];"boolean"===a.format?e[t]=!1:"number"===a.format?e[t]=a.min||0:"array"===a.format&&a.style&&"select"===a.style.curationView?e[t]=[]:"text"===a.format&&a.style&&"select"===a.style.curationView?e[t]=null:e[t]="","approved_symbol"===t&&this.approvedSymbol&&(e[t]=this.approvedSymbol),"hgnc_id"===t&&this.hgncId&&(e[t]=this.hgncId)})),this.precurationDetails&&this.precurationDetails.id){const t=this.precurationDetails.id;e["precurationDetails"]={[t]:this.precurationDetails}}return e},validateCurationData(e){const t=[];for(const[a,n]of Object.entries(c.U8))n.required&&!e[a]&&t.push(`The field "${n.label}" is required.`);return t},async saveCuration(){const e=JSON.parse(localStorage.getItem("user")).uid;try{for(const t of this.curationDataArray){t.workflowConfigVersionUsed=c.se,t.workflowConfigNameUsed=c.l9;let a,n=t.id;if(this.precurationDetails&&this.precurationDetails.geneDetails){const e=Object.keys(this.precurationDetails.geneDetails);e.length>0&&(a=e[0])}a||(a=await this.getGeneDocIdByGeneIdentifier(this.approvedSymbol||this.hgncId)),n?(await(0,v.lO)(n,t,e,c.U8),this.showSnackbar("Success",`Curation updated: ${n}`,"success")):(n=await(0,v.pK)(t,e,c.U8),this.showSnackbar("Success",`New curation created with ID: ${n}`,"success"),t.id=n),a&&await(0,p.zJ)(a,{hasCuration:n,curatedBy:e})}}catch(t){this.showSnackbar("Error",`Error saving curation: ${t.message}`,"error")}},async getGeneDocIdByGeneIdentifier(e){const t=await(0,p.Xu)(e);return t?t.docId:null}}};const V=(0,w.Z)(C,[["render",b],["__scopeId","data-v-a773850e"]]);var W=V;const x={class:"gene-links"};function U(e,t,a,o,l,r){const s=(0,n.up)("v-chip");return(0,n.wg)(),(0,n.iD)("div",x,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.activeLinks,(t=>((0,n.wg)(),(0,n.j4)(s,{key:t.name,onClick:a=>e.goToLink(t.url),size:"small"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(t.name),1)])),_:2},1032,["onClick"])))),128))])}var j=(0,n.aZ)({name:"GeneLinkChips",props:{hgncId:{type:String,default:null},geneSymbol:{type:String,default:null},omimId:{type:String,default:null},linksToShow:{type:Array,default:()=>[]}},setup(e){const t=(e,t,a)=>{if(!e)return null;const n="HGNC"===t?"HGNC:":"OMIM"===t?"OMIM:":"";return a&&!e.startsWith(n)?`${n}${e}`:!a&&e.startsWith(n)?e.replace(n,""):e},a={clingen:()=>{const a=t(e.hgncId,"HGNC",!0);return a?`https://search.clinicalgenome.org/kb/genes/${a}`:null},gencc:()=>{const a=t(e.hgncId,"HGNC",!0);return a?`https://search.thegencc.org/genes/${a}`:null},omim:()=>{const a=t(e.omimId,"OMIM",!1);return a?`https://www.omim.org/entry/${a}`:null},search_omim:()=>e.geneSymbol?`https://www.omim.org/search?index=entry&start=1&limit=10&sort=score+desc%2C+prefix_sort+desc&search=${e.geneSymbol}`:null},i=(0,n.Fl)((()=>e.linksToShow.map((e=>{const t=a[e]?a[e]():null;return{name:e,url:t}})).filter((e=>e.url)))),o=e=>{e&&window.open(e,"_blank")};return{activeLinks:i,goToLink:o}}});const I=(0,w.Z)(j,[["render",U],["__scopeId","data-v-7939178d"]]);var H=I,O={components:{GeneDetailCard:s.Z,PrecurationForm:f,CurationForm:W,GeneLinkChips:H},props:{item:{type:Object,required:!0},open:{type:Boolean,required:!0},context:{type:String,default:"gene"}},emits:["close"],setup(e,{emit:t}){const a=(0,r.iH)(e.open),i=(0,r.iH)({...e.item}),o=(0,r.iH)(!0),l=(0,r.iH)(!0),s=(0,r.iH)(!1),u=(0,r.iH)(0),c=(0,r.iH)(!1),p=(0,r.iH)(""),m=(0,r.iH)(""),h=(0,r.iH)("success"),w=(e,t,a="success")=>{m.value=e,p.value=t,h.value=a,c.value=!0};(0,n.m0)((()=>{a.value=e.open,i.value={...e.item}}));const g=(0,r.iH)(null),f=t=>{"precuration"===e.context?b():(g.value=t,s.value=!0,u.value=1)},b=()=>{t("close"),y.value=null,g.value=null},v=async()=>{try{const e=await(0,d.ds)(i.value.hgnc_id||i.value.approved_symbol);e?(g.value=e,s.value=!0,u.value=1):(s.value=!1,u.value=0)}catch(e){w("Error checking existing curation: "+e.message,"error")}},y=(0,r.iH)(null),k=e=>{y.value=e},D=(0,n.Fl)((()=>"curation"===e.context?"Curation":"precuration"===e.context?"Precuration":"Gene Curation"));(0,n.YP)((()=>e.open),(async e=>{e&&await _()}));const _=async()=>{"precuration"===e.context?(o.value=!1,l.value=!0,s.value=!1,u.value=0):"curation"===e.context?(o.value=!1,l.value=!1,await v(),u.value=s.value?1:0):await v()};return(0,n.YP)((()=>e.open),(e=>{e&&_()})),{initializeModal:_,isOpen:a,editedItem:i,close:b,handlePrecurationAccepted:f,showGeneDetailCard:o,showPreCurationTab:l,showCurationTab:s,tab:u,showSnackbar:w,snackbarVisible:c,snackbarMessage:p,snackbarTitle:m,snackbarColor:h,title:D,handleGeneDataLoaded:k,geneData:y,precurationDetails:g}}};const P=(0,w.Z)(O,[["render",l],["__scopeId","data-v-4396ccf2"]]);var S=P},4494:function(e,t,a){a.d(t,{Z:function(){return p}});var n=a(3396),i=a(7139);const o={key:0},l={key:1};function r(e,t,a,r,s,u){const c=(0,n.up)("v-tooltip"),d=(0,n.up)("router-link"),p=(0,n.up)("v-data-table"),m=(0,n.up)("v-pagination"),h=(0,n.up)("v-container");return(0,n.wg)(),(0,n.j4)(h,null,{default:(0,n.w5)((()=>[(0,n.Wm)(p,{headers:a.headers,items:a.items,"items-per-page":r.itemsPerPage,"onUpdate:itemsPerPage":t[0]||(t[0]=e=>r.itemsPerPage=e),"server-items-length":a.totalItems,loading:a.loading,class:"elevation-1",density:"compact"},(0,n.Nv)({_:2},[(0,n.Ko)(a.headers,(e=>({name:`header.${e.value}`,fn:(0,n.w5)((({header:t})=>[(0,n._)("span",null,(0,i.zw)(e.title),1),e.description?((0,n.wg)(),(0,n.j4)(c,{key:0,header:t,activator:"parent",location:"top"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(e.description),1)])),_:2},1032,["header"])):(0,n.kq)("",!0)]))}))),(0,n.Ko)(a.config.columns,(t=>({name:`item.${t.name}`,fn:(0,n.w5)((({item:a})=>["text"===t.type?((0,n.wg)(),(0,n.iD)("div",o,(0,i.zw)(a[t.name]),1)):"date"===t.type?((0,n.wg)(),(0,n.iD)("div",l,(0,i.zw)(r.formatTimestamp(a[t.name])),1)):"link"===t.type?((0,n.wg)(),(0,n.j4)(d,{key:2,to:t.to(a)},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(a[t.name]),1)])),_:2},1032,["to"])):"slot"===t.type?(0,n.WI)(e.$slots,t.slotName,{key:3,item:a}):(0,n.kq)("",!0)]))})))]),1032,["headers","items","items-per-page","server-items-length","loading"]),(0,n.WI)(e.$slots,"modal"),(0,n.Wm)(m,{modelValue:r.page,"onUpdate:modelValue":t[1]||(t[1]=e=>r.page=e),length:r.totalPages,"onUpdate:page":t[2]||(t[2]=t=>e.$emit("update-page",r.page))},null,8,["modelValue","length"])])),_:3})}var s=a(4870),u={props:{headers:Array,items:Array,config:Object,totalItems:Number,loading:Boolean},setup(e,{emit:t}){const a=(0,s.iH)(1),i=(0,s.iH)(10),o=(0,n.Fl)((()=>Math.ceil(e.totalItems/i.value))),l=e=>{if(!e)return"";const t=new Date(1e3*e.seconds);return t.toLocaleDateString()};return(0,n.YP)(a,(()=>{t("page-changed",a.value)})),(0,n.YP)(i,(()=>{t("items-per-page-changed",i.value)})),{page:a,itemsPerPage:i,totalPages:o,formatTimestamp:l}}},c=a(89);const d=(0,c.Z)(u,[["render",r]]);var p=d},7157:function(e,t,a){a.d(t,{Z:function(){return w}});var n=a(3396),i=a(7139);const o=["title"],l=["innerHTML"];function r(e,t,a,r,s,u){const c=(0,n.up)("HelpIcon"),d=(0,n.up)("v-card-title"),p=(0,n.up)("v-tooltip"),m=(0,n.up)("v-table"),h=(0,n.up)("v-card-text"),w=(0,n.up)("v-card"),g=(0,n.up)("v-alert"),f=(0,n.up)("v-container");return(0,n.wg)(),(0,n.j4)(f,null,{default:(0,n.w5)((()=>[r.gene?((0,n.wg)(),(0,n.j4)(w,{key:0,class:"mx-auto my-4","max-width":"800"},{default:(0,n.w5)((()=>[a.showTitle?((0,n.wg)(),(0,n.j4)(d,{key:0,class:"headline"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(r.gene.approved_symbol)+" ",1),(0,n.Wm)(c,{helpContent:r.helpContent},null,8,["helpContent"])])),_:1})):(0,n.kq)("",!0),(0,n.Wm)(h,null,{default:(0,n.w5)((()=>[(0,n.Wm)(m,{density:"compact"},{default:(0,n.w5)((()=>[(0,n._)("tbody",null,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(r.filteredGeneDetails,((e,t)=>((0,n.wg)(),(0,n.iD)("tr",{key:t},[(0,n._)("td",null,[(0,n._)("strong",null,[(0,n._)("span",{class:"label-hover",title:e.description},(0,i.zw)(e.label),9,o),(0,n.Wm)(p,{activator:"parent",location:"start"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(e.description),1)])),_:2},1024)])]),(0,n._)("td",{innerHTML:e.formattedValue},null,8,l)])))),128))])])),_:1})])),_:1})])),_:1})):((0,n.wg)(),(0,n.j4)(g,{key:1,type:"error"},{default:(0,n.w5)((()=>[(0,n.Uk)(" Gene not found or failed to load. ")])),_:1}))])),_:1})}var s=a(4870),u=a(3191),c=a(889),d=a(1924),p={props:{id:String,visibilityScope:{type:String,default:"standardView"},showTitle:{type:Boolean,default:!0}},components:{HelpIcon:d.Z},setup(e,{emit:t}){const a=c.$o.stages.gene.helpConfig,i=(0,s.iH)(null);(0,n.bv)((async()=>{if(e.id)try{const a=await(0,u.Xu)(e.id);i.value=a,t("gene-data-loaded",a)}catch(a){console.error("Error fetching gene:",a.message)}}));const o=(0,n.Fl)((()=>i.value?Object.entries(c.Wk).filter((([,t])=>t.visibility[e.visibilityScope])).map((([e,t])=>{const a=i.value[e];return{label:t.label,description:t.description||"",formattedValue:l(a,t)}})):[]));function l(e,t){if(null==e)return"N/A";switch(t.format){case"date":return new Date(1e3*e.seconds).toLocaleDateString();case"number":return parseFloat(e).toFixed(2);case"array":return e.join(", ");case"map":return Object.entries(e).map((([e,t])=>`${e}: ${t}`)).join(", ");case"text":return e;default:return JSON.stringify(e)}}return{gene:i,filteredGeneDetails:o,helpContent:a}}},m=a(89);const h=(0,m.Z)(p,[["render",r],["__scopeId","data-v-66758bd8"]]);var w=h},1924:function(e,t,a){a.d(t,{Z:function(){return h}});var n=a(3396);const i=(0,n._)("span",null,"Click for help",-1);function o(e,t,a,o,l,r){const s=(0,n.up)("v-icon"),u=(0,n.up)("v-tooltip"),c=(0,n.up)("HelpDialog");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(u,{bottom:""},{activator:(0,n.w5)((({attrs:e})=>[(0,n.Wm)(s,(0,n.dG)(e,{onClick:t[0]||(t[0]=e=>l.dialog=!0)}),{default:(0,n.w5)((()=>[(0,n.Uk)(" mdi-help-circle-outline ")])),_:2},1040)])),default:(0,n.w5)((()=>[i])),_:1}),(0,n.Wm)(c,{modelValue:l.dialog,"onUpdate:modelValue":t[1]||(t[1]=e=>l.dialog=e),helpContent:a.helpContent},null,8,["modelValue","helpContent"])],64)}var l=a(7139);function r(e,t,a,i,o,r){const s=(0,n.up)("v-card-title"),u=(0,n.up)("v-card-text"),c=(0,n.up)("v-btn"),d=(0,n.up)("v-card-actions"),p=(0,n.up)("v-card"),m=(0,n.up)("v-col"),h=(0,n.up)("v-row"),w=(0,n.up)("v-container"),g=(0,n.up)("v-spacer"),f=(0,n.up)("v-dialog");return(0,n.wg)(),(0,n.j4)(f,{modelValue:o.dialog,"onUpdate:modelValue":t[0]||(t[0]=e=>o.dialog=e),"max-width":"600px"},{default:(0,n.w5)((()=>[(0,n.Wm)(p,null,{default:(0,n.w5)((()=>[(0,n.Wm)(s,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,l.zw)(a.helpContent.HelpDialog.title),1)])),_:1}),(0,n.Wm)(w,null,{default:(0,n.w5)((()=>[(0,n.Wm)(h,null,{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(a.helpContent.sections,(e=>((0,n.wg)(),(0,n.j4)(m,{key:e.header,cols:"12"},{default:(0,n.w5)((()=>[(0,n.Wm)(p,{outlined:""},{default:(0,n.w5)((()=>[(0,n.Wm)(s,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,l.zw)(e.header),1)])),_:2},1024),(0,n.Wm)(u,{innerHTML:e.content},null,8,["innerHTML"]),e.links?((0,n.wg)(),(0,n.j4)(d,{key:0},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.links,(e=>((0,n.wg)(),(0,n.j4)(c,{key:e.title,href:e.url,text:""},{default:(0,n.w5)((()=>[(0,n.Uk)((0,l.zw)(e.title),1)])),_:2},1032,["href"])))),128))])),_:2},1024)):(0,n.kq)("",!0)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1}),(0,n.Wm)(d,null,{default:(0,n.w5)((()=>[(0,n.Wm)(g),(0,n.Wm)(c,{color:"primary",onClick:r.close},{default:(0,n.w5)((()=>[(0,n.Uk)("Close")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"])}var s={name:"HelpDialog",props:{helpContent:{type:Object,required:!0}},data(){return{dialog:!1}},emits:["update:modelValue"],methods:{close(){this.$emit("update:modelValue",!1)}}},u=a(89);const c=(0,u.Z)(s,[["render",r]]);var d=c,p={components:{HelpDialog:d},props:{helpContent:{type:Object,required:!0}},data(){return{dialog:!1}},methods:{openHelpDialog(){console.log(this.helpContent),this.dialog=!0}}};const m=(0,u.Z)(p,[["render",o]]);var h=m}}]);
//# sourceMappingURL=261.51937042.js.map