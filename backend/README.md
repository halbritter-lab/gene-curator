# Gene Curator Backend

## Overview

The Gene Curator backend is a FastAPI-based application that provides a schema-agnostic platform for genetic curation. It uses **uv** for fast and modern Python dependency management.

## Development Setup

### Prerequisites

- Python 3.10+
- [uv](https://docs.astral.sh/uv/) (Python package manager)
- Docker and Docker Compose (for full development environment)

### Quick Start with uv

1. **Install uv** (if not already installed):
   ```bash
   # On macOS/Linux
   curl -LsSf https://astral.sh/uv/install.sh | sh
   
   # On Windows
   powershell -c "irm https://astral.sh/uv/install.ps1 | iex"
   
   # Or with pip
   pip install uv
   ```

2. **Set up the development environment**:
   ```bash
   cd backend
   
   # Create virtual environment and install dependencies
   uv sync --extra dev
   
   # Activate the virtual environment
   source .venv/bin/activate  # On Unix/macOS
   # or
   .venv\Scripts\activate     # On Windows
   ```

3. **Run the development server**:
   ```bash
   uv run uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
   ```

### Development Commands

#### Dependency Management
```bash
# Add a new dependency
uv add fastapi

# Add a development dependency
uv add --dev pytest

# Update dependencies
uv lock --upgrade

# Install dependencies
uv sync

# Show dependency tree
uv tree
```

#### Code Quality
```bash
# Run all linting checks
uv run python scripts/lint.py

# Auto-format code
uv run python scripts/format.py

# Run individual tools
uv run ruff check app/
uv run ruff format app/
uv run mypy app/
uv run bandit -r app/
```

#### Testing
```bash
# Run all tests
uv run pytest

# Run with coverage
uv run pytest --cov=app --cov-report=html

# Run specific test file
uv run pytest app/tests/test_health.py
```

## Modern Python Tooling with uv

### Benefits of uv

- **10-100x faster** dependency resolution and installation
- **Drop-in replacement** for pip and pip-tools
- **Built-in virtual environment management**
- **Better caching** and more efficient disk usage
- **Active development** with frequent improvements

### Compatibility

The project maintains full compatibility with existing Python packaging standards:
- Standard `pyproject.toml` format (PEP 621)
- Compatible with pip, setuptools, and other tools
- Works with existing CI/CD pipelines
- Standard virtual environments

## Project Structure

```
backend/
├── app/                    # Main application code
│   ├── api/               # API routes and endpoints
│   ├── core/              # Core configuration and utilities
│   ├── crud/              # Database CRUD operations
│   ├── models/            # SQLAlchemy database models
│   ├── schemas/           # Pydantic schemas
│   ├── scoring/           # Pluggable scoring engines
│   └── tests/             # Test suite
├── scripts/               # Development scripts
├── pyproject.toml         # Project configuration (uv-compatible)
├── uv.lock               # Locked dependencies (generated by uv)
└── README.md             # This file
```

## Database

The backend uses PostgreSQL with SQLAlchemy ORM. See the main project README for database setup instructions.

## API Documentation

When running the development server, interactive API documentation is available at:
- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc

## Environment Variables

Create a `.env` file in the backend directory with:

```env
DATABASE_URL=postgresql://user:password@localhost:5432/gene_curator
SECRET_KEY=your-secret-key-here
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7
```

## Troubleshooting

### uv Issues

If you encounter issues with uv:

1. **Update uv**: `uv self update`
2. **Clear cache**: `uv cache clean`
3. **Reinstall dependencies**: `rm uv.lock && uv sync`

### Docker Issues

If Docker builds are slow:

1. **Use BuildKit**: `export DOCKER_BUILDKIT=1`
2. **Clear Docker cache**: `docker builder prune`
3. **Rebuild without cache**: `docker-compose build --no-cache backend`

## Contributing

1. **Code Style**: Use `uv run python scripts/format.py` to format code
2. **Linting**: Run `uv run python scripts/lint.py` before committing
3. **Tests**: Ensure all tests pass with `uv run pytest`
4. **Dependencies**: Use `uv add` to add new dependencies

## Performance

With uv, dependency installation is significantly faster:

| Operation | Poetry | uv | Improvement |
|-----------|--------|-----|-------------|
| Fresh install | ~45s | ~3s | 15x faster |
| Cached install | ~15s | ~1s | 15x faster |
| Dependency resolution | ~20s | ~1s | 20x faster |

This dramatically improves development experience and CI/CD pipeline performance.